<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>orderly changelog • orderly</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="orderly changelog">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orderly</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/orderly.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/changelog.html">orderly changelog</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vimc/orderly">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>orderly changelog</h1>
                        <h4 class="author">Rich FitzJohn</h4>
            
            <h4 class="date">2019-08-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vimc/orderly/blob/master/vignettes/changelog.Rmd"><code>vignettes/changelog.Rmd</code></a></small>
      <div class="hidden name"><code>changelog.Rmd</code></div>

    </div>

    
    
<div id="the-orderly-changelog" class="section level1">
<h1 class="hasAnchor">
<a href="#the-orderly-changelog" class="anchor"></a>The orderly changelog</h1>
<p>From version 0.6.0, <code>orderly</code> supports the concept of a “changelog”. This turns out to be somewhat more complicated than expected, so the details are explained here.</p>
<div id="users-perspective" class="section level2">
<h2 class="hasAnchor">
<a href="#users-perspective" class="anchor"></a>Users perspective</h2>
<p>From the user perspective, the changelog functionality should be fairly simple. Alongside any <code>orderly.yml</code> file, one can have a <code>changelog.txt</code> file, which will contain description of changes. This file will look like:</p>
<pre class="plain"><code>[public]
Started working with new version of the data.  This includes
everything sent up to 2018-10-10

[internal]
Fixed incorrect plotting</code></pre>
<p>The short strings within <code>[</code> and <code>]</code> are a <em>label</em> - everything between a label and the next label or the end of file is a <em>value</em> (these can span multiple lines, contain blank lines, etc).</p>
<p>Over time, the changelog is <strong>prepended</strong>, i.e., new information is added to the <em>top</em> of the changelog. Existing entries must be left unaltered.</p>
<p>Messages can be provided to orderly run and these are required to be in the format <code>[label] value</code>.</p>
<p>Once a report is run (via <code><a href="../reference/orderly_run.html">orderly::orderly_run()</a></code>, or via <code>orderly run</code> on the command line), the given changelog, along with any message, is compared with the last committed version of this report, and entries that are introduced on this round are identified. We add the report id to the entries, and a randomly generated unique id to each new entry. This is saved in <code>orderly_run.rds</code> along with other report metadata.</p>
</div>
<div id="details" class="section level2">
<h2 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h2>
<p>There are a few complications here</p>
<ul>
<li>we need to accept changelog entries that are not present in a file (e.g., from the <code>message</code> argument)</li>
<li>we don’t know the id until after running a report so we can’t easily structure a changelog file in the conventional sense. Instead we have to detect “old” and “new” entries</li>
<li>detecting “old” entries is complicated by the fact that there might be multiple places that reports are run (development machine, staging environment, production environment) but ultimately one source of truth</li>
</ul>
<p>This section documents the logic involved in making this work.</p>
<p>When preparing to run an orderly report:</p>
<ol style="list-style-type: decimal">
<li>we read in the plaintext changelog if it exists</li>
<li>parse all messages provided and add as if they were a changelog entry <code>from_file</code> of <code>FALSE</code>
</li>
<li>we look for the “latest” archived version of this report and read the changelog from that reports <code>orderly_run.rds</code> file. Alternatively we can use a remote copy of orderly via the interface here (not implemented yet).</li>
<li>filter the previous previous changelog to remove any <code>from_file = FALSE</code> entries and confirm that our new changelog can be prepended to the previous</li>
<li>add the <code>id</code> to the “new” entries and prepend this - save the resulting data into the new report’s <code>orderly_run.yml</code>
</li>
</ol>
<p>For checking against the API, we will use <code>GET reports/:name/versions/version/latest/changelog/</code> with the current report name as <code>:name</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#the-orderly-changelog">The orderly changelog</a><ul class="nav nav-pills nav-stacked">
<li><a href="#users-perspective">Users perspective</a></li>
      <li><a href="#details">Details</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Rich FitzJohn, Robert Ashton, Alex Hill, Martin Eden, Wes Hinsley, Emma Russell, James Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
